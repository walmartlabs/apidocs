<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>com.walmartlabs.active-status documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Active-status</span> <span class="project-version">0.1.15</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>com</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>walmartlabs</span></div></div></li><li class="depth-3 current"><a href="com.walmartlabs.active-status.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>active-status</span></div></a></li><li class="depth-4 branch"><a href="com.walmartlabs.active-status.component.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>component</span></div></a></li><li class="depth-4 branch"><a href="com.walmartlabs.active-status.minimal-board.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>minimal-board</span></div></a></li><li class="depth-4 branch"><a href="com.walmartlabs.active-status.progress.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>progress</span></div></a></li><li class="depth-4"><a href="com.walmartlabs.active-status.workers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>workers</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-*terminal-type*"><div class="inner"><span>*terminal-type*</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-bar"><div class="inner"><span>bar</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-change-status"><div class="inner"><span>change-status</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-clear-progress"><div class="inner"><span>clear-progress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-complete-progress"><div class="inner"><span>complete-progress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-console-status-board"><div class="inner"><span>console-status-board</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-default-console-configuration"><div class="inner"><span>default-console-configuration</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-default-progress-formatter"><div class="inner"><span>default-progress-formatter</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-JobUpdater"><div class="inner"><span>JobUpdater</span></div></a></li><li class="depth-2"><a href="com.walmartlabs.active-status.html#var-update-job"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>update-job</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-progress-tick"><div class="inner"><span>progress-tick</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-set-prefix"><div class="inner"><span>set-prefix</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-set-progress-formatter"><div class="inner"><span>set-progress-formatter</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-start-progress"><div class="inner"><span>start-progress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-StatusBoardTermination"><div class="inner"><span>StatusBoardTermination</span></div></a></li><li class="depth-2"><a href="com.walmartlabs.active-status.html#var-shutdown.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shutdown!</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-StatusJobInitiation"><div class="inner"><span>StatusJobInitiation</span></div></a></li><li class="depth-2"><a href="com.walmartlabs.active-status.html#var-add-job"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>add-job</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-tput"><div class="inner"><span>tput</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-with-output-redirected"><div class="inner"><span>with-output-redirected</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-with-output-redirected*"><div class="inner"><span>with-output-redirected*</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">com.walmartlabs.active-status</h1><div class="doc"><div class="markdown"><p>Present asynchronous status of multiple concurrent jobs within a command-line application.</p></div></div><div class="public anchor" id="var-*terminal-type*"><h3>*terminal-type*</h3><h4 class="dynamic">dynamic</h4><h4 class="added">added in 0.1.2</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>The terminal type used when invoking the <a href="com.walmartlabs.active-status.html#var-tput">tput</a>. Defaults to the value of the <code>TERM</code> environment variable or, if not set, the explicit value <code>xterm</code>.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L180">view source</a></div></div><div class="public anchor" id="var-bar"><h3>bar</h3><h4 class="added">added in 0.1.7</h4><div class="usage"><code>(bar completed-ratio)</code><code>(bar bar-length completed-ratio)</code></div><div class="doc"><div class="markdown"><p>Returns a string representation of a bar, used when formatting progress. The default bar length (number of characters) is 30.</p>
<p>The bar is generated using ANSI block characters.</p>
<p>The ratio should be between 0 (inclusive) and 1 (non-inclusive).</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L148">view source</a></div></div><div class="public anchor" id="var-change-status"><h3>change-status</h3><div class="usage"><code>(change-status value)</code></div><div class="doc"><div class="markdown"><p>Returns a job update value that changes the status of the job (this does not affect its summary message or other properties).</p>
<p>The status of a job will affect the overall color of the job’s line on the status board.</p>
<dl>
  <dt>value</dt>
  <dd>One of: :normal (the default), :success, :warning, :error.</dd>
</dl></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L535">view source</a></div></div><div class="public anchor" id="var-clear-progress"><h3>clear-progress</h3><div class="usage"><code>(clear-progress)</code></div><div class="doc"><div class="markdown"><p>Returns an update value for a job to clear the progress entirely, removing the progress bar.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L568">view source</a></div></div><div class="public anchor" id="var-complete-progress"><h3>complete-progress</h3><div class="usage"><code>(complete-progress)</code></div><div class="doc"><div class="markdown"><p>Returns a job update value for a job to complete its progress (setting its current amount to its target amount).</p>
<p>This is especially useful given that, on a very busy system, the occasional job update value may be discarded.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L559">view source</a></div></div><div class="public anchor" id="var-console-status-board"><h3>console-status-board</h3><div class="usage"><code>(console-status-board)</code><code>(console-status-board configuration)</code></div><div class="doc"><div class="markdown"><p>Creates a new status board suitable for use in a command-line application.</p>
<p>Only a single console status board should be active at any one time; they will interfere with each other.</p>
<p>The status board presents the status of any number of jobs. In this implementation, each job has a line in the status board, and can be updated individually and asynchronously.</p>
<p>Each job has a summary message, an optional status (:normal, :success, :warning, :error), and optional progress state.</p>
<p>The job’s status determines the font color for the entire line. If progress state exists, then a progress bar is included for the job.</p>
<p>The board is presented using simple text, and updates in place, using terminal capability strings to position the cursor, clear existing content on a line, and so forth.</p>
<p>The status board runs as a core.async process.</p>
<p>This function returns the status board; the status board can be passed to <a href="com.walmartlabs.active-status.html#var-add-job">add-job</a>.</p>
<p>Pass the status board to <a href="com.walmartlabs.active-status.html#var-shutdown.21">shutdown!</a> to shut down the status board immediately.</p>
<dl>
  <dt>configuration</dt>
  <dd>The configuration to use for the status board, defaulting to <a href="null">default-configuration</a>.</dd>
</dl>
<p>The console status board depends on the <code>tput</code> command to be present on the system path; it invokes <code>tput</code> in a sub-shell to obtain terminal capabilities. In addition, if the <code>TERM</code> environment variable is not set, a default, <code>xterm</code>, is passed to <code>tput</code>.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L473">view source</a></div></div><div class="public anchor" id="var-default-console-configuration"><h3>default-console-configuration</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The configuration used (by default) for a console status board.</p>
<dl>
  <dt>:dim-after-millis
  </dt>
  <dd>Milliseconds after which the status dims from bold to normal; defaults to 1000 ms.</dd>
  <dt>:update-millis
  </dt>
  <dd>Interval at which the status board will be updated; default to 100ms.</dd>
  <dt>:progress-formatter
  </dt>
  <dd>Function that formats the ::progress data of a job, if present.  Defaults to <a href="com.walmartlabs.active-status.html#var-default-progress-formatter">default-progress-formatter</a>.</dd>
  <dt>:out
  </dt>
  <dd>Where to send output, defaults to <code>*out*</code>.</dd>
</dl></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L453">view source</a></div></div><div class="public anchor" id="var-default-progress-formatter"><h3>default-progress-formatter</h3><h4 class="added">added in 0.1.7</h4><div class="usage"><code>(default-progress-formatter progress)</code></div><div class="doc"><div class="markdown"><p>Default function used for formatting progress; uses the ::current and ::target keys of the progress map.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L164">view source</a></div></div><div class="public anchor" id="var-JobUpdater"><h3>JobUpdater</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>A protocol that indicates how a particular job is updated by a particular type.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-update-job"><h3>update-job</h3><div class="usage"><code>(update-job this job)</code></div><div class="doc"><div class="markdown"></div></div></div></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L97">view source</a></div></div><div class="public anchor" id="var-progress-tick"><h3>progress-tick</h3><div class="usage"><code>(progress-tick)</code><code>(progress-tick amount)</code></div><div class="doc"><div class="markdown"><p>Returns a job update value for a job to increment its progress. The default amount is 1.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L553">view source</a></div></div><div class="public anchor" id="var-set-prefix"><h3>set-prefix</h3><h4 class="added">added in 0.1.4</h4><div class="usage"><code>(set-prefix prefix)</code></div><div class="doc"><div class="markdown"><p>Returns an update value for a job to set its prefix.</p>
<p>The prefix typically is used to provide an identity to a job.</p>
<p>The prefix should typically end with a space, to separate it from the job’s summary text.</p>
<p>The prefix may be set to nil to remove it.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L573">view source</a></div></div><div class="public anchor" id="var-set-progress-formatter"><h3>set-progress-formatter</h3><h4 class="added">added in 0.1.7</h4><div class="usage"><code>(set-progress-formatter formatter)</code></div><div class="doc"><div class="markdown"><p>Sets the progress formatter for the job to the provided function, or nil to return to the default progress formatter.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L586">view source</a></div></div><div class="public anchor" id="var-start-progress"><h3>start-progress</h3><div class="usage"><code>(start-progress target)</code></div><div class="doc"><div class="markdown"><p>Returns a job update value that starts progress torwards the indicated total.</p>
<p>The job’s status line will include a progress bar.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L546">view source</a></div></div><div class="public anchor" id="var-StatusBoardTermination"><h3>StatusBoardTermination</h3><h4 class="type">protocol</h4><h4 class="added">added in 0.1.11</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-shutdown.21"><h3>shutdown!</h3><div class="usage"><code>(shutdown! board)</code></div><div class="doc"><div class="markdown"><p>Shuts the status board down, terminating all jobs, and blocking until final output is written to the console.</p>
<p>Returns nil.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L65">view source</a></div></div><div class="public anchor" id="var-StatusJobInitiation"><h3>StatusJobInitiation</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-add-job"><h3>add-job</h3><div class="usage"><code>(add-job board)</code><code>(add-job board options)</code></div><div class="doc"><div class="markdown"><p>Adds a new job to an existing status board, returning a channel for updates to the job.</p>
<p>You may put updates into the job’s channel, or close the channel, to terminate the job.</p>
<p>The primary job update is just a String, which changes the summary text for the job.</p>
<p>Other update objects can change the visible status of the job, or enable and update a progress bar specific to the job. Functions such as <a href="com.walmartlabs.active-status.html#var-change-status">change-status</a> and <a href="com.walmartlabs.active-status.html#var-start-progress">start-progress</a> return job update values that can be put into the job’s channel.</p>
<p>Example:</p>
<pre><code>(require '[com.walmartlabs.active-status :as as]
         '[clojure.core.async :refer [close! &gt;!!]])

(defn process-files [board files]
  (let [job-ch (as/add-job board)]
      (&gt;!! job-ch (as/start-progress (count files)))
      (doseq [f files]
        (&gt;!! job-ch (str "Processing: " f))
        (process-single-file f)
        (&gt;!! job-ch (as/progress-tick)))
      (close! job-ch)))
</code></pre>
<p>When a job is changed in any way, it will briefly be highlighted (in bold font). If not updated for a set period of time (by default, 1 second) it will then dim (normal font).</p>
<p>A terminated job will stay visible, but is moved up above any non-terminated jobs. It will highlight for a moment as well.</p>
<dl>
  <dt>board</dt>
  <dd>The status board, as returned by <a href="com.walmartlabs.active-status.html#var-console-status-board">console-status-board</a>.</dd>
  <dt>options</dt>
  <dd>A map of additional options:</dd>
  <dt>:status
  </dt>
  <dd>The initial status for the job (:normal, :success, :warning, :error).</dd>
  <dt>:pinned
  </dt>
  <dd>If true, then any update to the job will move it to the first (bottommost) line, shifting others up.  You rarely want more than one pinned job.</dd>
  <dt>:prefix
  </dt>
  <dd>Job prefix string (as per <a href="com.walmartlabs.active-status.html#var-set-prefix">set-prefix</a>).</dd>
</dl></div></div></div></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L15">view source</a></div></div><div class="public anchor" id="var-tput"><h3>tput</h3><h4 class="added">added in 0.1.7</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Invokes the <code>tput</code> command in a shell, passing it all arguments passed to this function.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L203">view source</a></div></div><div class="public anchor" id="var-with-output-redirected"><h3>with-output-redirected</h3><h4 class="type">macro</h4><h4 class="added">added in 0.1.8</h4><div class="usage"><code>(with-output-redirected base-path &amp; forms)</code></div><div class="doc"><div class="markdown"><p>Rebinds <code>*out*</code> and <code>*err*</code> to files while executing the provided forms.</p>
<p>The status board should alredy be started and will continue to use the binding of <code>*out*</code> in place when it was created.</p>
<p>The base-path will have suffixes <code>.out</code> and <code>.err</code> appended to it; the files and directory containing them will be created.</p>
<p>Returns the result of the final form.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L640">view source</a></div></div><div class="public anchor" id="var-with-output-redirected*"><h3>with-output-redirected*</h3><h4 class="added">added in 0.1.8</h4><div class="usage"><code>(with-output-redirected* base-path f)</code></div><div class="doc"><div class="markdown"><p>Rebinds <code>*out*</code> and <code>*err*</code> to files while executing the provided function.</p>
<p>The status board should alredy be started and will continue to use the binding of <code>*out*</code> in place when it was created.</p>
<p>The base-path will have suffixes <code>.out</code> and <code>.err</code> appended to it; the files and directory containing them will be created.</p>
<p>Returns the result of invoking the function.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status.clj#L593">view source</a></div></div></div></body></html>