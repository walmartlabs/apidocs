<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>com.walmartlabs.active-status documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Active-status</span> <span class="project-version">0.1.3</span></span></a></h1></div><div class="sidebar primary"><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>com</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>walmartlabs</span></div></div></li><li class="depth-3 current"><a href="com.walmartlabs.active-status.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>active-status</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-*terminal-type*"><div class="inner"><span>*terminal-type*</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var--.3EChangeStatus"><div class="inner"><span>-&gt;ChangeStatus</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var--.3EClearProgress"><div class="inner"><span>-&gt;ClearProgress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var--.3ECompleteProgress"><div class="inner"><span>-&gt;CompleteProgress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var--.3EProgressTick"><div class="inner"><span>-&gt;ProgressTick</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var--.3EStartProgress"><div class="inner"><span>-&gt;StartProgress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-add-job"><div class="inner"><span>add-job</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-change-status"><div class="inner"><span>change-status</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-clear-progress"><div class="inner"><span>clear-progress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-complete-progress"><div class="inner"><span>complete-progress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-console-status-board"><div class="inner"><span>console-status-board</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-default-console-configuration"><div class="inner"><span>default-console-configuration</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-find-min-line"><div class="inner"><span>find-min-line</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-JobUpdater"><div class="inner"><span>JobUpdater</span></div></a></li><li class="depth-2"><a href="com.walmartlabs.active-status.html#var-update-job"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>update-job</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-map-.3EChangeStatus"><div class="inner"><span>map-&gt;ChangeStatus</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-map-.3EClearProgress"><div class="inner"><span>map-&gt;ClearProgress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-map-.3ECompleteProgress"><div class="inner"><span>map-&gt;CompleteProgress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-map-.3EProgressTick"><div class="inner"><span>map-&gt;ProgressTick</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-map-.3EStartProgress"><div class="inner"><span>map-&gt;StartProgress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-progress-tick"><div class="inner"><span>progress-tick</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.html#var-start-progress"><div class="inner"><span>start-progress</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">com.walmartlabs.active-status</h1><div class="doc"><div class="markdown"><p>Manage asynchronous status of multiple concurrent jobs within a command-line application.</p></div></div><div class="public anchor" id="var-*terminal-type*"><h3>*terminal-type*</h3><h4 class="dynamic">dynamic</h4><h4 class="added">added in 0.1.2</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>The terminal type used when invoking <code>tput</code>. Defaults to the value of the TERM environment variable or, if not set, the explicit value &lsquo;term&rsquo;.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L121">view source</a></div></div><div class="public anchor" id="var--.3EChangeStatus"><h3>-&gt;ChangeStatus</h3><div class="usage"><code>(-&gt;ChangeStatus new-status)</code></div><div class="doc"><div class="markdown"><p>Positional factory function for class com.walmartlabs.active_status.ChangeStatus.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L71">view source</a></div></div><div class="public anchor" id="var--.3EClearProgress"><h3>-&gt;ClearProgress</h3><div class="usage"><code>(-&gt;ClearProgress)</code></div><div class="doc"><div class="markdown"><p>Positional factory function for class com.walmartlabs.active_status.ClearProgress.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L53">view source</a></div></div><div class="public anchor" id="var--.3ECompleteProgress"><h3>-&gt;CompleteProgress</h3><div class="usage"><code>(-&gt;CompleteProgress)</code></div><div class="doc"><div class="markdown"><p>Positional factory function for class com.walmartlabs.active_status.CompleteProgress.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L47">view source</a></div></div><div class="public anchor" id="var--.3EProgressTick"><h3>-&gt;ProgressTick</h3><div class="usage"><code>(-&gt;ProgressTick amount)</code></div><div class="doc"><div class="markdown"><p>Positional factory function for class com.walmartlabs.active_status.ProgressTick.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L41">view source</a></div></div><div class="public anchor" id="var--.3EStartProgress"><h3>-&gt;StartProgress</h3><div class="usage"><code>(-&gt;StartProgress target)</code></div><div class="doc"><div class="markdown"><p>Positional factory function for class com.walmartlabs.active_status.StartProgress.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L34">view source</a></div></div><div class="public anchor" id="var-add-job"><h3>add-job</h3><div class="usage"><code>(add-job board-ch)</code><code>(add-job board-ch options)</code></div><div class="doc"><div class="markdown"><p>Adds a new job, returning a channel for updates to the job.</p>
<p>You may put updates into the job&rsquo;s channel, or close the channel, to terminate the job.</p>
<p>The primary job update is just a String, which changes the summary text for the job.</p>
<p>Other update objects can change the visible status of the job, or enable and update a progress bar specific to the job. Functions such as <a href="com.walmartlabs.active-status.html#var-change-status">change-status</a> and <a href="com.walmartlabs.active-status.html#var-start-progress">start-progress</a> return job update values that can be put into the job&rsquo;s channel.</p>
<p>Example:</p>
<pre><code>(require &#39;[com.walmartlabs.active-status :as as]
         &#39;[clojure.core.async :refer [close! &gt;!!]])

(defn process-files [board-ch files]
  (let [job-ch (as/add-job board-ch)]
      (&gt;!! job-ch (as/start-progress (count files)))
      (doseq [f files]
        (&gt;!! job-ch (str &quot;Processing: &quot; f))
        (process-single-file f)
        (&gt;!! job-ch (as/progress-tick)))
      (close! job-ch)))
</code></pre>
<p>When a job is changed in any way, it will briefly be highlighted (in bold font). If not updated for a set period of time (by default, 1 second) it will then dim (normal font).</p>
<p>A terminated job will stay visible, but is moved up above any non-terminated jobs. It will highlight for a moment as well.</p>
<dl>
  <dt>board-ch
  </dt>
  <dd>The channel for the score board, as returned by <a href="com.walmartlabs.active-status.html#var-console-status-board">console-status-board</a>.</dd>
  <dt>options</dt>
  <dd>A map of additional options:</dd>
  <dt>:status
  </dt>
  <dd>The initial status for the job (:normal, :success, :warning, :error).</dd>
  <dt>:pinned
  </dt>
  <dd>If true, then any update to the job will move it to the first line, shifting others up.  You rarely want more than one pinned job.</dd>
</dl></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L440">view source</a></div></div><div class="public anchor" id="var-change-status"><h3>change-status</h3><div class="usage"><code>(change-status value)</code></div><div class="doc"><div class="markdown"><p>Returns a job update value that changes the status of the job (this does not affect its summary message or other properties).</p>
<p>The status of a job will affect the overall color of the job&rsquo;s line on the status board.</p>
<dl>
  <dt>value</dt>
  <dd>One of: :normal (the default), :success, :warning, :error.</dd>
</dl></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L493">view source</a></div></div><div class="public anchor" id="var-clear-progress"><h3>clear-progress</h3><div class="usage"><code>(clear-progress)</code></div><div class="doc"><div class="markdown"><p>Returns an update value for a job to clear the progress entirely, removing the progress bar.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L526">view source</a></div></div><div class="public anchor" id="var-complete-progress"><h3>complete-progress</h3><div class="usage"><code>(complete-progress)</code></div><div class="doc"><div class="markdown"><p>Returns a job update value for a job to complete its progress (setting its current amount to its target amount).</p>
<p>This is especially useful given that, on a very busy system, the occasional job update value may be discarded.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L517">view source</a></div></div><div class="public anchor" id="var-console-status-board"><h3>console-status-board</h3><div class="usage"><code>(console-status-board)</code><code>(console-status-board configuration)</code></div><div class="doc"><div class="markdown"><p>Creates a new status board suitable for use in a command-line application.</p>
<p>Only a single console status board should be active at any one time; they will interfere with each other.</p>
<p>The status board presents the status of any number of jobs. In this implementation, each job has a line in the status board, and can be updated individually and asynchronously.</p>
<p>Each job has a summary message, an optional status (:normal, :success, :warning, :error), and optional progress state.</p>
<p>The job&rsquo;s status control the font color for the entire line. If progress state exists, then a progress bar is included for the job.</p>
<p>The board is presented using simple text, and updates in place, using terminal capability strings to position the cursor, clear existing content on a line, and so forth.</p>
<p>The status board runs as a core.async process.</p>
<p>This function returns a channel; the channel can be passed to <a href="com.walmartlabs.active-status.html#var-add-job">add-job</a>.</p>
<p>Close the returned channel to shut down the status board immediately.</p>
<p>Note that when testing in the REPL, you may see slightly odd output as the REPL will return and print nil <em>before</em> the final update to the status board. Adding a short sleep after closing the status board channel, but before returning, is useful in the REPL.</p>
<dl>
  <dt>configuration</dt>
  <dd>The configuration to use for the status board, defaulting to <a href="null">default-configuration</a>.</dd>
</dl>
<p>The console status board depends on the <code>tput</code> command to be present on the system path; it invokes <code>tput</code> in a sub-shell to obtain terminal capabilities. In addition, if the <code>TERM</code> environment variable is not set, a default, <code>xterm</code>, is passed to <code>tput</code>.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L396">view source</a></div></div><div class="public anchor" id="var-default-console-configuration"><h3>default-console-configuration</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The configuration used (by default) for a console status board.</p>
<dl>
  <dt>:dim-after-millis
  </dt>
  <dd>Milliseconds after which the status dims from bold to normal; defaults to 1000 ms.</dd>
  <dt>:update-millis
  </dt>
  <dd>Interval at which the status board will be updated; default to 100ms.</dd>
  <dt>:progress-column
  </dt>
  <dd>Column in which to display progress (which may truncate the job&rsquo;s summary);  defaults to 55.</dd>
</dl></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L380">view source</a></div></div><div class="public anchor" id="var-find-min-line"><h3>find-min-line</h3><div class="usage"><code>(find-min-line jobs pred)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L221">view source</a></div></div><div class="public anchor" id="var-JobUpdater"><h3>JobUpdater</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>A protocol that indicates how a particular job is updated by a particular type.</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-update-job"><h3>update-job</h3><div class="usage"><code>(update-job this job)</code></div><div class="doc"><div class="markdown"></div></div></div></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L30">view source</a></div></div><div class="public anchor" id="var-map-.3EChangeStatus"><h3>map-&gt;ChangeStatus</h3><div class="usage"><code>(map-&gt;ChangeStatus m__6289__auto__)</code></div><div class="doc"><div class="markdown"><p>Factory function for class com.walmartlabs.active_status.ChangeStatus, taking a map of keywords to field values.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L71">view source</a></div></div><div class="public anchor" id="var-map-.3EClearProgress"><h3>map-&gt;ClearProgress</h3><div class="usage"><code>(map-&gt;ClearProgress m__6289__auto__)</code></div><div class="doc"><div class="markdown"><p>Factory function for class com.walmartlabs.active_status.ClearProgress, taking a map of keywords to field values.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L53">view source</a></div></div><div class="public anchor" id="var-map-.3ECompleteProgress"><h3>map-&gt;CompleteProgress</h3><div class="usage"><code>(map-&gt;CompleteProgress m__6289__auto__)</code></div><div class="doc"><div class="markdown"><p>Factory function for class com.walmartlabs.active_status.CompleteProgress, taking a map of keywords to field values.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L47">view source</a></div></div><div class="public anchor" id="var-map-.3EProgressTick"><h3>map-&gt;ProgressTick</h3><div class="usage"><code>(map-&gt;ProgressTick m__6289__auto__)</code></div><div class="doc"><div class="markdown"><p>Factory function for class com.walmartlabs.active_status.ProgressTick, taking a map of keywords to field values.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L41">view source</a></div></div><div class="public anchor" id="var-map-.3EStartProgress"><h3>map-&gt;StartProgress</h3><div class="usage"><code>(map-&gt;StartProgress m__6289__auto__)</code></div><div class="doc"><div class="markdown"><p>Factory function for class com.walmartlabs.active_status.StartProgress, taking a map of keywords to field values.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L34">view source</a></div></div><div class="public anchor" id="var-progress-tick"><h3>progress-tick</h3><div class="usage"><code>(progress-tick)</code><code>(progress-tick amount)</code></div><div class="doc"><div class="markdown"><p>Returns a job update value for a job to increment its progress. The default amount is 1.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L511">view source</a></div></div><div class="public anchor" id="var-start-progress"><h3>start-progress</h3><div class="usage"><code>(start-progress target)</code></div><div class="doc"><div class="markdown"><p>Returns a job update value that starts progress torwards the indicated total.</p>
<p>The job&rsquo;s status line will include a progress bar.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/master/src/com/walmartlabs/active_status.clj#L504">view source</a></div></div></div></body></html>