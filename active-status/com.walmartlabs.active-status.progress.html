<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>com.walmartlabs.active-status.progress documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Active-status</span> <span class="project-version">0.1.15</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>com</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>walmartlabs</span></div></div></li><li class="depth-3"><a href="com.walmartlabs.active-status.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>active-status</span></div></a></li><li class="depth-4 branch"><a href="com.walmartlabs.active-status.component.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>component</span></div></a></li><li class="depth-4 branch"><a href="com.walmartlabs.active-status.minimal-board.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>minimal-board</span></div></a></li><li class="depth-4 branch current"><a href="com.walmartlabs.active-status.progress.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>progress</span></div></a></li><li class="depth-4"><a href="com.walmartlabs.active-status.workers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>workers</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="com.walmartlabs.active-status.progress.html#var-elapsed-time-job"><div class="inner"><span>elapsed-time-job</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.progress.html#var-format-elapsed-time"><div class="inner"><span>format-elapsed-time</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.progress.html#var-report-progress"><div class="inner"><span>report-progress</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.active-status.progress.html#var-report-progress.3F"><div class="inner"><span>report-progress?</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">com.walmartlabs.active-status.progress</h1><h4 class="added">added in 0.1.15</h4><div class="doc"><div class="markdown"><p>Utilties to make it easier for long-running jobs to report progress.</p></div></div><div class="public anchor" id="var-elapsed-time-job"><h3>elapsed-time-job</h3><div class="usage"><code>(elapsed-time-job status-board)</code><code>(elapsed-time-job status-board options)</code></div><div class="doc"><div class="markdown"><p>Starts a job that presents elapsed time. This continues until the status board is shutdown.</p>
<dl>
  <dt>Options</dt>
  <dt>:delay-millis (default 0)
  </dt>
  <dd>Delay before the job is created and first updated.</dd>
  <dt>:interval-millis (default 1000)
  </dt>
  <dd>Interval between updates.</dd>
  <dt>:prefix (default <code>elapsed time:</code>)
  </dt>
  <dd>Prefix for job.</dd>
  <dt>:formatter (default <a href="com.walmartlabs.active-status.progress.html#var-format-elapsed-time">format-elapsed-time</a>)
  </dt>
  <dd>Formats elapsed time to a string.</dd>
</dl></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status/progress.clj#L103">view source</a></div></div><div class="public anchor" id="var-format-elapsed-time"><h3>format-elapsed-time</h3><div class="usage"><code>(format-elapsed-time millis)</code></div><div class="doc"><div class="markdown"><p>Formats a number of milliseconds of elapsed time into units of days, hours, minutes, and seconds.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status/progress.clj#L89">view source</a></div></div><div class="public anchor" id="var-report-progress"><h3>report-progress</h3><div class="usage"><code>(report-progress interval job-ch formatter)</code></div><div class="doc"><div class="markdown"><p>Returns a transducer that counts and periodically reports the progress (using a status board job), including a final summary at the end.</p>
<p>The interval is in terms of values that pass through the tranducer.</p>
<p>The formatter is generally a string passed to <code>format</code>, along with the current count. Alternately, it can be a function that is passed the count and returns a string.</p>
<p>Technically, this is a count of how many values have passed through this tranducer (but could be queued elsewhere after this tranducer), but that is generally accurate enough for reporting progress.</p>
<p>Example:</p>
<pre><code>(let [rows-ch (query-db ...)           ;; returns channel that conveys rows
      job-ch (as/add-job status-board)
      work-ch (asyc/pipe rows-ch (chan 1 (report-progress 25 job-ch "read %,d rows")))]
  (go-loop []
    (when-let [row (&lt;! work-ch)]
       ...                             ;; do work with the row
       (recur))))
</code></pre>
<p>This will report on the job every 25 rows, and once more (with the final count) when the rows-ch channel closes.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status/progress.clj#L15">view source</a></div></div><div class="public anchor" id="var-report-progress.3F"><h3>report-progress?</h3><div class="usage"><code>(report-progress? n interval)</code></div><div class="doc"><div class="markdown"><p>Returns true if n is non-zero and an even multiple of interval.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/active-status/blob/master/src/com/walmartlabs/active_status/progress.clj#L9">view source</a></div></div></div></body></html>