<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>com.walmartlabs.lacinia.resolve documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">com.walmartlabs/lacinia</span> <span class="project-version">1.2-alpha-3</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>com</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>walmartlabs</span></div></div></li><li class="depth-3"><a href="com.walmartlabs.lacinia.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lacinia</span></div></a></li><li class="depth-4 branch"><a href="com.walmartlabs.lacinia.executor.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>executor</span></div></a></li><li class="depth-4 branch"><a href="com.walmartlabs.lacinia.expound.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>expound</span></div></a></li><li class="depth-4 branch"><a href="com.walmartlabs.lacinia.federation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>federation</span></div></a></li><li class="depth-4"><a href="com.walmartlabs.lacinia.parser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>parser</span></div></a></li><li class="depth-5 branch"><a href="com.walmartlabs.lacinia.parser.docs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>docs</span></div></a></li><li class="depth-5"><a href="com.walmartlabs.lacinia.parser.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li><li class="depth-4 branch current"><a href="com.walmartlabs.lacinia.resolve.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>resolve</span></div></a></li><li class="depth-4 branch"><a href="com.walmartlabs.lacinia.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li><li class="depth-4 branch"><a href="com.walmartlabs.lacinia.selection.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>selection</span></div></a></li><li class="depth-4 branch"><a href="com.walmartlabs.lacinia.tracing.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tracing</span></div></a></li><li class="depth-4"><a href="com.walmartlabs.lacinia.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-*callback-executor*"><div class="inner"><span>*callback-executor*</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-as-resolver-fn"><div class="inner"><span>as-resolver-fn</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-FieldResolver"><div class="inner"><span>FieldResolver</span></div></a></li><li class="depth-2"><a href="com.walmartlabs.lacinia.resolve.html#var-resolve-value"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>resolve-value</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-is-resolver-result.3F"><div class="inner"><span>is-resolver-result?</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-resolve-as"><div class="inner"><span>resolve-as</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-resolve-promise"><div class="inner"><span>resolve-promise</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-ResolverResult"><div class="inner"><span>ResolverResult</span></div></a></li><li class="depth-2"><a href="com.walmartlabs.lacinia.resolve.html#var-on-deliver.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>on-deliver!</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-ResolverResultPromise"><div class="inner"><span>ResolverResultPromise</span></div></a></li><li class="depth-2"><a href="com.walmartlabs.lacinia.resolve.html#var-deliver.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deliver!</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-with-context"><div class="inner"><span>with-context</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-with-error"><div class="inner"><span>with-error</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-with-extensions"><div class="inner"><span>with-extensions</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-with-warning"><div class="inner"><span>with-warning</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.resolve.html#var-wrap-resolver-result"><div class="inner"><span>wrap-resolver-result</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">com.walmartlabs.lacinia.resolve</h1><div class="doc"><div class="markdown"><p>Complex results for field resolver functions.</p>
<p>Resolver functions may return a value directly, or return a value in an immediate or asynchronous <a href="com.walmartlabs.lacinia.resolve.html#var-ResolverResult">ResolverResult</a>.  The resolved value may be wrapped in a a modifier:</p>
<ul>
<li><a href="com.walmartlabs.lacinia.resolve.html#var-with-error">with-error</a></li>
<li><a href="com.walmartlabs.lacinia.resolve.html#var-with-warning">with-warning</a></li>
<li><a href="com.walmartlabs.lacinia.resolve.html#var-with-context">with-context</a></li>
<li><a href="com.walmartlabs.lacinia.resolve.html#var-with-extensions">with-extensions</a></li>
</ul>
<p>The modifiers exist to resolve a value <em>and</em> to perform a side effect, such as adding an error to the execution result.</p>
<p>A value or wrapped value may be returned asynchronously using a <a href="com.walmartlabs.lacinia.resolve.html#var-ResolverResultPromise">ResolverResultPromise</a>.</p>
<p>The <a href="com.walmartlabs.lacinia.resolve.html#var-FieldResolver">FieldResolver</a> protocol allows a Clojure record to act as a field resolver function.</p>
</div></div><div class="public anchor" id="var-*callback-executor*"><h3>*callback-executor*</h3><h4 class="dynamic">dynamic</h4><h4 class="added">added in 0.20.0</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>If non-nil, then specifies a java.util.concurrent.Executor (typically, a thread pool of some form) used to invoke callbacks when ResolveResultPromises are delivered.</p>
<p>Starting in 1.2, this is always bound when query execution begins.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L39">view source</a></div></div><div class="public anchor" id="var-as-resolver-fn"><h3>as-resolver-fn</h3><h4 class="added">added in 0.24.0</h4><div class="usage"><code>(as-resolver-fn field-resolver)</code></div><div class="doc"><div class="markdown"><p>Wraps a <a href="com.walmartlabs.lacinia.resolve.html#var-FieldResolver">FieldResolver</a> instance as a field resolver function.</p>
<p>If the field-resolver provided is a function or a Var, it is returned unchanged.</p>
<p>Anything other value will cause an exception to be thrown.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L249">view source</a></div></div><div class="public anchor" id="var-FieldResolver"><h3>FieldResolver</h3><h4 class="type">protocol</h4><h4 class="added">added in 0.24.0</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Allows a Clojure record to operate as a field resolver.</p>
</div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-resolve-value"><h3>resolve-value</h3><div class="usage"><code>(resolve-value this context args value)</code></div><div class="doc"><div class="markdown"><p>The analog of a field resolver function, this method is passed the instance, and the standard context, field arguments, and container value, and returns a resolved value.</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L49">view source</a></div></div><div class="public anchor" id="var-is-resolver-result.3F"><h3>is-resolver-result?</h3><h4 class="added">added in 0.23.0</h4><div class="usage"><code>(is-resolver-result? value)</code></div><div class="doc"><div class="markdown"><p>Is the provided value actually a <a href="com.walmartlabs.lacinia.resolve.html#var-ResolverResult">ResolverResult</a>?</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L227">view source</a></div></div><div class="public anchor" id="var-resolve-as"><h3>resolve-as</h3><div class="usage"><code>(resolve-as resolved-value)</code><code>(resolve-as resolved-value resolver-error)</code></div><div class="doc"><div class="markdown"><p>Invoked by field resolvers to wrap a simple return value as a ResolverResult.</p>
<p>The two-arguments version is a convenience around using <a href="com.walmartlabs.lacinia.resolve.html#var-with-error">with-error</a>.</p>
<p>This is an immediately realized ResolverResult.</p>
<p>Use <a href="com.walmartlabs.lacinia.resolve.html#var-resolve-promise">resolve-promise</a> and <a href="com.walmartlabs.lacinia.resolve.html#var-deliver.21">deliver!</a> for an asynchronous result.</p>
<p>When <a href="com.walmartlabs.lacinia.resolve.html#var-on-deliver.21">on-deliver!</a> is invoked, the provided callback is immediately invoked (in the same thread).</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L140">view source</a></div></div><div class="public anchor" id="var-resolve-promise"><h3>resolve-promise</h3><div class="usage"><code>(resolve-promise)</code></div><div class="doc"><div class="markdown"><p>Returns a <a href="com.walmartlabs.lacinia.resolve.html#var-ResolverResultPromise">ResolverResultPromise</a>.</p>
<p>At creation, the promise will capture per-thread bindings and ensure they are conveyed to the callback, should the callback be invoked asynchronously (when <code>*callback-executor*</code> is bound to an Executor).</p>
<p>A value must be resolved and ultimately provided via <a href="com.walmartlabs.lacinia.resolve.html#var-deliver.21">deliver!</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L214">view source</a></div></div><div class="public anchor" id="var-ResolverResult"><h3>ResolverResult</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>A special type returned from a field resolver that can contain a resolved value. A ResolverResult encapsulates the difference between when Lacinia invokes a field resolver function, and when the value computed by that field resolver is ready.</p>
<p>In most cases, a field resolver returns a simple value, which is wrapped by <a href="com.walmartlabs.lacinia.resolve.html#var-resolve-as">resolve-as</a> into a ResolverResult.</p>
<p>More sophisticated field resolvers can return a ResolverResultPromise (via <a href="com.walmartlabs.lacinia.resolve.html#var-resolve-promise">resolve-promise</a>), and deliver the result’s value asynchronously via <a href="com.walmartlabs.lacinia.resolve.html#var-deliver.21">deliver!</a>.</p>
</div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-on-deliver.21"><h3>on-deliver!</h3><div class="usage"><code>(on-deliver! this callback)</code></div><div class="doc"><div class="markdown"><p>Provides a callback that is invoked immediately after the ResolverResult is realized. The callback is passed the ResolverResult’s value.</p>
<p><code>on-deliver!</code> should only be invoked once. It returns <code>this</code>.</p>
<p>On a simple ResolverResult (not a ResolverResultPromise), the callback is invoked immediately.</p>
<p>For a <a href="com.walmartlabs.lacinia.resolve.html#var-ResolverResultPromise">ResolverResultPromise</a>, the callback may be invoked on another thread. Per-thread bindings in place when <code>on-deliver!</code> is invoked will be restored prior to invoking the callback.</p>
<p>The callback is invoked for side-effects; its result is ignored.</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L90">view source</a></div></div><div class="public anchor" id="var-ResolverResultPromise"><h3>ResolverResultPromise</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>A specialization of ResolverResult that supports asynchronous delivery of the resolved value and errors.</p>
</div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-deliver.21"><h3>deliver!</h3><div class="usage"><code>(deliver! this value)</code><code>(deliver! this value error)</code></div><div class="doc"><div class="markdown"><p>Invoked to realize the ResolverResult, triggering the callback to receive the value.</p>
<p>The callback is invoked in the current thread, unless <a href="null">*thread-pool*</a> is non-nil, in which case the callback is invoked in a pooled thread.</p>
<p>The two arguments version is simply a convenience around the <a href="com.walmartlabs.lacinia.resolve.html#var-with-error">with-error</a> modifier.</p>
<p>Returns <code>this</code>.</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L117">view source</a></div></div><div class="public anchor" id="var-with-context"><h3>with-context</h3><h4 class="added">added in 0.19.0</h4><div class="usage"><code>(with-context value context-map)</code></div><div class="doc"><div class="markdown"><p>Wraps a value so that when nested fields (at any depth) are executed, the provided values will be in the context.</p>
<p>The provided context-map is merged onto the application context.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L82">view source</a></div></div><div class="public anchor" id="var-with-error"><h3>with-error</h3><h4 class="added">added in 0.19.0</h4><div class="usage"><code>(with-error value error)</code></div><div class="doc"><div class="markdown"><p>Wraps a value, modifying it to include an error map.</p>
<p>The provided error map will be enhanced with a :location key, identifying where field occurs within the query document, and a :path key, identifying the sequence of fields (or aliases) and list indexes within the :data key of the result map.</p>
<p>Any additional keys in the error map beyond :message (which must be present, and must be a string) will be added to an embedded :extensions map.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L68">view source</a></div></div><div class="public anchor" id="var-with-extensions"><h3>with-extensions</h3><h4 class="added">added in 0.31.0</h4><div class="usage"><code>(with-extensions value f &amp; args)</code></div><div class="doc"><div class="markdown"><p>Wraps a value with an update to the extensions for the request.</p>
<p>The extensions are a map, and this applies a change to that map, as with clojure.core/update: the function is provided with the current value of the extensions map and the arguments, and returns the new value of the extensions map.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L326">view source</a></div></div><div class="public anchor" id="var-with-warning"><h3>with-warning</h3><h4 class="added">added in 0.31.0</h4><div class="usage"><code>(with-warning value warning)</code></div><div class="doc"><div class="markdown"><p>As with <a href="com.walmartlabs.lacinia.resolve.html#var-with-error">with-error</a>, but the error map will be added to the :warnings key of the root :extensions map (not to the root :errors map).  Errors should only be used to indicate a substantial failure, whereas warnings are more advisory.  It is up to the application to determine what situations call for an error and what call for a warning.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L336">view source</a></div></div><div class="public anchor" id="var-wrap-resolver-result"><h3>wrap-resolver-result</h3><h4 class="added">added in 0.23.0</h4><div class="usage"><code>(wrap-resolver-result resolver wrapper-fn)</code></div><div class="doc"><div class="markdown"><p>Wraps a resolver function or (<a href="com.walmartlabs.lacinia.resolve.html#var-FieldResolver">FieldResolver</a> instance), passing the result through a wrapper function.</p>
<p>The wrapper function is passed four values:  the context, arguments, and value as passed to the resolver, then the resolved value from the resolver.</p>
<p><code>wrap-resolver-result</code> understands resolver functions that return either a <a href="com.walmartlabs.lacinia.resolve.html#var-ResolverResult">ResolverResult</a> or a bare value, as well as values wrapped with a modifier (such as <a href="com.walmartlabs.lacinia.resolve.html#var-with-error">with-error</a>).</p>
<p>The wrapper-fn is passed the underlying value and must return a new value. The new value will be re-wrapped with modifiers as necessary.</p>
<p>The new value returned by the wrapper-fn may itself be a ResolverResult, and the value (either plain, or inside a ResolverResult) may also be modified (via <a href="com.walmartlabs.lacinia.resolve.html#var-with-error">with-error</a>, etc.).</p>
<p>Returns a standard field resolver function, with the standard three parameters (context, args, value).</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia/blob/master/src/com/walmartlabs/lacinia/resolve.clj#L272">view source</a></div></div></div></body></html>