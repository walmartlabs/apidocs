<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>com.walmartlabs.lacinia.pedestal2 documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">com.walmartlabs/lacinia-pedestal</span> <span class="project-version">1.1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>com</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>walmartlabs</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lacinia</span></div></div></li><li class="depth-4 branch"><a href="com.walmartlabs.lacinia.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-4"><a href="com.walmartlabs.lacinia.pedestal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pedestal</span></div></a></li><li class="depth-5 branch"><a href="com.walmartlabs.lacinia.pedestal.cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cache</span></div></a></li><li class="depth-5 branch"><a href="com.walmartlabs.lacinia.pedestal.interceptors.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interceptors</span></div></a></li><li class="depth-5 branch"><a href="com.walmartlabs.lacinia.pedestal.spec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></a></li><li class="depth-5"><a href="com.walmartlabs.lacinia.pedestal.subscriptions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>subscriptions</span></div></a></li><li class="depth-4 current"><a href="com.walmartlabs.lacinia.pedestal2.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>pedestal2</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-async-query-executor-handler"><div class="inner"><span>async-query-executor-handler</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-body-data-interceptor"><div class="inner"><span>body-data-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-default-interceptors"><div class="inner"><span>default-interceptors</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-default-service"><div class="inner"><span>default-service</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-disallow-subscriptions-interceptor"><div class="inner"><span>disallow-subscriptions-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-enable-graphiql"><div class="inner"><span>enable-graphiql</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-enable-subscriptions"><div class="inner"><span>enable-subscriptions</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-enable-tracing-interceptor"><div class="inner"><span>enable-tracing-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-error-response-interceptor"><div class="inner"><span>error-response-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-graphiql-asset-routes"><div class="inner"><span>graphiql-asset-routes</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-graphiql-ide-handler"><div class="inner"><span>graphiql-ide-handler</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-graphql-data-interceptor"><div class="inner"><span>graphql-data-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-initialize-tracing-interceptor"><div class="inner"><span>initialize-tracing-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-inject-app-context-interceptor"><div class="inner"><span>inject-app-context-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-json-response-interceptor"><div class="inner"><span>json-response-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-missing-query-interceptor"><div class="inner"><span>missing-query-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-prepare-query-interceptor"><div class="inner"><span>prepare-query-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-query-executor-handler"><div class="inner"><span>query-executor-handler</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-query-parser-interceptor"><div class="inner"><span>query-parser-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal2.html#var-status-conversion-interceptor"><div class="inner"><span>status-conversion-interceptor</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">com.walmartlabs.lacinia.pedestal2</h1><h4 class="added">added in 0.14.0</h4><div class="doc"><div class="markdown"><p>Utilities for creating handlers, interceptors, routes, and service maps needed by a Pedestal service that exposes a GraphQL API and GraphiQL IDE.</p>
</div></div><div class="public anchor" id="var-async-query-executor-handler"><h3>async-query-executor-handler</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Async variant of <a href="com.walmartlabs.lacinia.pedestal2.html#var-query-executor-handler">query-executor-handler</a> which returns a channel that conveys the updated context.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L174">view source</a></div></div><div class="public anchor" id="var-body-data-interceptor"><h3>body-data-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Converts the POSTed body from a input stream into a string, or rejects the request with a 400 response if the content type is not application/json.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L43">view source</a></div></div><div class="public anchor" id="var-default-interceptors"><h3>default-interceptors</h3><div class="usage"><code>(default-interceptors compiled-schema)</code><code>(default-interceptors compiled-schema app-context)</code><code>(default-interceptors compiled-schema app-context options)</code></div><div class="doc"><div class="markdown"><p>Returns the default set of GraphQL interceptors, as a seq:</p>
<ul>
<li>::initialize-tracing <a href="com.walmartlabs.lacinia.pedestal2.html#var-initialize-tracing-interceptor">initialize-tracing-interceptor</a></li>
<li>::json-response <a href="com.walmartlabs.lacinia.pedestal2.html#var-json-response-interceptor">json-response-interceptor</a></li>
<li>::error-response <a href="com.walmartlabs.lacinia.pedestal2.html#var-error-response-interceptor">error-response-interceptor</a></li>
<li>::body-data <a href="com.walmartlabs.lacinia.pedestal2.html#var-body-data-interceptor">body-data-interceptor</a></li>
<li>::graphql-data <a href="com.walmartlabs.lacinia.pedestal2.html#var-graphql-data-interceptor">graphql-data-interceptor</a></li>
<li>::status-conversion <a href="com.walmartlabs.lacinia.pedestal2.html#var-status-conversion-interceptor">status-conversion-interceptor</a></li>
<li>::missing-query <a href="com.walmartlabs.lacinia.pedestal2.html#var-missing-query-interceptor">missing-query-interceptor</a></li>
<li>::query-parser <a href="com.walmartlabs.lacinia.pedestal2.html#var-query-parser-interceptor">query-parser-interceptor</a></li>
<li>::disallow-subscriptions <a href="com.walmartlabs.lacinia.pedestal2.html#var-disallow-subscriptions-interceptor">disallow-subscriptions-interceptor</a></li>
<li>::prepare-query <a href="com.walmartlabs.lacinia.pedestal2.html#var-prepare-query-interceptor">prepare-query-interceptor</a></li>
<li>::inject-app-context <a href="com.walmartlabs.lacinia.pedestal2.html#var-inject-app-context-interceptor">inject-app-context-interceptor</a></li>
<li>::enable-tracing <a href="com.walmartlabs.lacinia.pedestal2.html#var-enable-tracing-interceptor">enable-tracing-interceptor</a></li>
<li>::query-executor <a href="com.walmartlabs.lacinia.pedestal2.html#var-query-executor-handler">query-executor-handler</a></li>
</ul>
<p><code>compiled-schema</code> may be the actual compiled schema, or a no-arguments function that returns the compiled schema.</p>
<p><code>app-context</code> is the application context that will be passed into all resolvers (the <a href="com.walmartlabs.lacinia.pedestal2.html#var-inject-app-context-interceptor">inject-app-context-interceptor</a> adds a :request key to this map).</p>
<p>The options map may contain key :parsed-query-cache, which will be used by the ::query-parser interceptor.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L205">view source</a></div></div><div class="public anchor" id="var-default-service"><h3>default-service</h3><div class="usage"><code>(default-service compiled-schema options)</code></div><div class="doc"><div class="markdown"><p>Returns a default Pedestal service map, with subscriptions and GraphiQL enabled.</p>
<p>The defaults put the GraphQL API at <code>/api</code> and the GraphiQL IDE at <code>/ide</code> (and subscriptions endpoint at <code>/ws</code>).</p>
<p>Unlike earlier versions of lacinia-pedestal, only POST is supported, and the content type must be <code>application/json</code>.</p>
<p>compiled-schema is either the compiled schema itself, or a function returning the compiled schema.</p>
<p>options is a map combining options needed by <a href="null">graphiql-ide-route</a>, <a href="com.walmartlabs.lacinia.pedestal2.html#var-default-interceptors">default-interceptors</a>, <a href="com.walmartlabs.lacinia.pedestal2.html#var-enable-subscriptions">enable-subscriptions</a>, and <a href="com.walmartlabs.lacinia.pedestal.subscriptions.html#var-listener-fn-factory">listener-fn-factory</a>.</p>
<p>It may also contain keys :app-context and :port (which defaults to 8888).</p>
<p>You can also define an explicit :host address to your application. Useful when running inside Docker.</p>
<p>This is useful for initial development and exploration, but applications with any more sophisticated needs should construct their service map directly.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L326">view source</a></div></div><div class="public anchor" id="var-disallow-subscriptions-interceptor"><h3>disallow-subscriptions-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Handles requests for subscriptions.  Subscription requests must only be sent to the subscriptions web-socket, not the general query endpoint, so any subscription request received in this pipeline is a bad request.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L141">view source</a></div></div><div class="public anchor" id="var-enable-graphiql"><h3>enable-graphiql</h3><div class="usage"><code>(enable-graphiql service-map)</code></div><div class="doc"><div class="markdown"><p>Disables secure headers in the service map, a prerequisite for GraphiQL requests to operate.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L321">view source</a></div></div><div class="public anchor" id="var-enable-subscriptions"><h3>enable-subscriptions</h3><div class="usage"><code>(enable-subscriptions service-map compiled-schema subscription-options)</code></div><div class="doc"><div class="markdown"><p>Updates a Pedestal service map to add support for subscriptions.</p>
<p>As elsewhere, the compiled-schema may be a function that returns the compiled schema.</p>
<p>The subscription options are documented at <a href="com.walmartlabs.lacinia.pedestal.subscriptions.html#var-listener-fn-factory">listener-fn-factory</a>, with the addition of :subscriptions-path (defaulting to “/ws”).</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L308">view source</a></div></div><div class="public anchor" id="var-enable-tracing-interceptor"><h3>enable-tracing-interceptor</h3><h4 class="added">added in 0.15.0</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Enables tracing if the <code>lacinia-tracing</code> header is present.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L194">view source</a></div></div><div class="public anchor" id="var-error-response-interceptor"><h3>error-response-interceptor</h3><h4 class="added">added in 0.14.0</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Returns an internal server error response when an exception was not handled in prior interceptors.</p>
<p>This must come after <a href="com.walmartlabs.lacinia.pedestal2.html#var-json-response-interceptor">json-response-interceptor</a>, as the error still needs to be converted to json.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L35">view source</a></div></div><div class="public anchor" id="var-graphiql-asset-routes"><h3>graphiql-asset-routes</h3><div class="usage"><code>(graphiql-asset-routes asset-path)</code></div><div class="doc"><div class="markdown"><p>Returns a set of routes for retrieving GraphiQL assets (CSS and JS).</p>
<p>These routes are needed for the GraphiQL IDE to operate.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L247">view source</a></div></div><div class="public anchor" id="var-graphiql-ide-handler"><h3>graphiql-ide-handler</h3><div class="usage"><code>(graphiql-ide-handler options)</code></div><div class="doc"><div class="markdown"><p>Returns a handler for the GraphiQL IDE.</p>
<p>A route can be constructed from this handler.</p>
<p>Options:</p>
<dl>
<dt>:api-path (default: “/api”)</dt>
<dd>Path at which GraphQL requests are serviced.</dd>
<dt>:asset-path (default: “/assets/graphiql”)</dt>
<dd>Path from which the JavaScript and CSS assets may be loaded.</dd>
<dt>:subscriptions-path (default: “/ws”)</dt>
<dd>Path for web socket connections, to handle GraphQL subscriptions.</dd>
<dt>:ide-headers</dt>
<dd>A map from header name to header value. Keys and values may be strings, keywords, or symbols and are converted to strings using clojure.core/name. These define additional headers to be included in the requests from the IDE. Typically, the headers are used to identify and authenticate the requests.</dd>
</dl>
<p>The default for :ide-headers is `{“lacinia-tracing”, “true”} to enable GraphQL tracing from inside the GraphiQL IDE&gt;</p>
<dl>
<dt>:ide-connection-params</dt>
<dd>A value that is used with the GraphiQL IDE; this value is converted to JSON, and becomes the connectionParams passed in the initial subscription web service call; this can be used to identify and authenticate subscription requests.</dd>
</dl>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L268">view source</a></div></div><div class="public anchor" id="var-graphql-data-interceptor"><h3>graphql-data-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Comes after <a href="com.walmartlabs.lacinia.pedestal2.html#var-body-data-interceptor">body-data-interceptor</a>, extracts the JSON query and other data into request keys :graphql-query (the query document as a string), :graphql-vars (a map) and :graphql-operation-name (a string).</p>
<p>These keys are dissoc’ed on leave, or on error.</p>
<p>Comes after <a href="com.walmartlabs.lacinia.pedestal2.html#var-body-data-interceptor">body-data-interceptor</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L58">view source</a></div></div><div class="public anchor" id="var-initialize-tracing-interceptor"><h3>initialize-tracing-interceptor</h3><h4 class="added">added in 0.15.0</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Initializes timing information for the request; largely, this captures the earliest possible start time for the request (before any other interceptors), just in case tracing is enabled for this request (that decision is made by <a href="com.walmartlabs.lacinia.pedestal2.html#var-enable-tracing-interceptor">enable-tracing-interceptor</a>).</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L181">view source</a></div></div><div class="public anchor" id="var-inject-app-context-interceptor"><h3>inject-app-context-interceptor</h3><div class="usage"><code>(inject-app-context-interceptor app-context)</code></div><div class="doc"><div class="markdown"><p>Adds a :lacinia-app-context key to the request, used when executing the query.</p>
<p>The provided app-context map is augmented with the request map, as key :request.</p>
<p>On leave (or error), the :lacinia-app-context key is dissoc’ed.</p>
<p>It is not uncommon to replace this interceptor with one that constructs the application context dynamically; for example, to extract authentication information from the request and expose that as app-context keys.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L148">view source</a></div></div><div class="public anchor" id="var-json-response-interceptor"><h3>json-response-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>An interceptor that sees if the response body is a map and, if so, converts the map to JSON and sets the response Content-Type header.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L28">view source</a></div></div><div class="public anchor" id="var-missing-query-interceptor"><h3>missing-query-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Rejects the request with a 400 response is the JSON query variable is missing or blank.</p>
<p>Comes after <a href="com.walmartlabs.lacinia.pedestal2.html#var-graphql-data-interceptor">graphql-data-interceptor</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L88">view source</a></div></div><div class="public anchor" id="var-prepare-query-interceptor"><h3>prepare-query-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Prepares (with query variables) and validates the query, previously parsed by <a href="com.walmartlabs.lacinia.pedestal2.html#var-query-parser-interceptor">query-parser-interceptor</a>.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L125">view source</a></div></div><div class="public anchor" id="var-query-executor-handler"><h3>query-executor-handler</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The handler at the end of interceptor chain, invokes Lacinia to execute the query and return the main response.</p>
<p>This comes last in the interceptor chain.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L165">view source</a></div></div><div class="public anchor" id="var-query-parser-interceptor"><h3>query-parser-interceptor</h3><div class="usage"><code>(query-parser-interceptor compiled-schema)</code><code>(query-parser-interceptor compiled-schema cache)</code></div><div class="doc"><div class="markdown"><p>Given a compiled schema, returns an interceptor that parses the query.</p>
<p><code>compiled-schema</code> may be the actual compiled schema, or a no-arguments function that returns the compiled schema.</p>
<p>Expected to come after <a href="com.walmartlabs.lacinia.pedestal2.html#var-missing-query-interceptor">missing-query-interceptor</a> in the interceptor chain.</p>
<p>Adds a new request key, :parsed-lacinia-query, containing the parsed query. This key is removed on leave or on error.</p>
<p><code>cache</code> defaults to nil, it should implement <a href="com.walmartlabs.lacinia.pedestal.cache.html#var-ParsedQueryCache">ParsedQueryCache</a>.</p>
<p>Before execution, <a href="com.walmartlabs.lacinia.pedestal2.html#var-prepare-query-interceptor">prepare-query-interceptor</a> injects query variables and performs validations.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L100">view source</a></div></div><div class="public anchor" id="var-status-conversion-interceptor"><h3>status-conversion-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Checks to see if any error map in the :errors key of the response contains a :status value (under it’s :extensions key). If so, the maximum status value of such errors is found and used as the status of the overall response, and the :status key is dissoc’ed from all errors.</p>
</div></div><div class="src-link"><a href="https://github.com/walmartlabs/lacinia-pedestal/blob/master/src/com/walmartlabs/lacinia/pedestal2.clj#L132">view source</a></div></div></div></body></html>