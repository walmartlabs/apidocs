<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>com.walmartlabs.lacinia.pedestal documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Lacinia-pedestal</span> <span class="project-version">0.4.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>com</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>walmartlabs</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lacinia</span></div></div></li><li class="depth-4 branch"><a href="com.walmartlabs.lacinia.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-4 current"><a href="com.walmartlabs.lacinia.pedestal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pedestal</span></div></a></li><li class="depth-5 branch"><a href="com.walmartlabs.lacinia.pedestal.interceptors.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interceptors</span></div></a></li><li class="depth-5"><a href="com.walmartlabs.lacinia.pedestal.subscriptions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>subscriptions</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-async-query-executor-handler"><div class="inner"><span>async-query-executor-handler</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-bad-request"><div class="inner"><span>bad-request</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-body-data-interceptor"><div class="inner"><span>body-data-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-content-type"><div class="inner"><span>content-type</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-disallow-subscriptions-interceptor"><div class="inner"><span>disallow-subscriptions-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-extract-query"><div class="inner"><span>extract-query</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-graphql-data-interceptor"><div class="inner"><span>graphql-data-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-graphql-interceptors"><div class="inner"><span>graphql-interceptors</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-graphql-routes"><div class="inner"><span>graphql-routes</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-inject-app-context-interceptor"><div class="inner"><span>inject-app-context-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-json-response-interceptor"><div class="inner"><span>json-response-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-missing-query-interceptor"><div class="inner"><span>missing-query-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-parse-content-type"><div class="inner"><span>parse-content-type</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-pedestal-service"><div class="inner"><span>pedestal-service</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-query-executor-handler"><div class="inner"><span>query-executor-handler</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-query-parser-interceptor"><div class="inner"><span>query-parser-interceptor</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-routes-from-interceptor-map"><div class="inner"><span>routes-from-interceptor-map</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.lacinia.pedestal.html#var-status-conversion-interceptor"><div class="inner"><span>status-conversion-interceptor</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">com.walmartlabs.lacinia.pedestal</h1><div class="doc"><div class="markdown"><p>Defines Pedestal interceptors and supporting code.</p></div></div><div class="public anchor" id="var-async-query-executor-handler"><h3>async-query-executor-handler</h3><h4 class="added">added in 0.2.0</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Async variant of <a href="com.walmartlabs.lacinia.pedestal.html#var-query-executor-handler">query-executor-handler</a> which returns a channel that conveys the updated context.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L261">view source</a></div></div><div class="public anchor" id="var-bad-request"><h3>bad-request</h3><div class="usage"><code>(bad-request body)</code><code>(bad-request status body)</code></div><div class="doc"><div class="markdown"><p>Generates a bad request Ring response.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L24">view source</a></div></div><div class="public anchor" id="var-body-data-interceptor"><h3>body-data-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Converts the POSTed body from a input stream into a string.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L105">view source</a></div></div><div class="public anchor" id="var-content-type"><h3>content-type</h3><div class="usage"><code>(content-type request)</code></div><div class="doc"><div class="markdown"><p>Gets the content-type of a request. (without encoding)</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L51">view source</a></div></div><div class="public anchor" id="var-disallow-subscriptions-interceptor"><h3>disallow-subscriptions-interceptor</h3><h4 class="added">added in 0.3.0</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Handles requests for subscriptions.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L276">view source</a></div></div><div class="public anchor" id="var-extract-query"><h3>extract-query</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Based on the content type of the query, adds up to three keys to the request:</p>
<dl>
  <dt>:graphql-query
  </dt>
  <dd>The query itself, as a string (parsing the query happens later)</dd>
  <dt>:graphql-vars
  </dt>
  <dd>A map of variables used when executing the query.</dd>
  <dt>:graphql-operation-name
  </dt>
  <dd>The specific operation requested (for queries that define multiple named operations).</dd>
</dl></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L57">view source</a></div></div><div class="public anchor" id="var-graphql-data-interceptor"><h3>graphql-data-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Extracts the raw data (query and variables) from the request using <a href="com.walmartlabs.lacinia.pedestal.html#var-extract-query">extract-query</a>.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L112">view source</a></div></div><div class="public anchor" id="var-graphql-interceptors"><h3>graphql-interceptors</h3><h4 class="added">added in 0.3.0</h4><div class="usage"><code>(graphql-interceptors compiled-schema options)</code></div><div class="doc"><div class="markdown"><p>Returns a dependency map of the GraphQL interceptors:</p>
<ul>
  <li>::json-response <a href="com.walmartlabs.lacinia.pedestal.html#var-json-response-interceptor">json-response-interceptor</a></li>
  <li>::graphql-data <a href="com.walmartlabs.lacinia.pedestal.html#var-graphql-data-interceptor">graphql-data-interceptor</a></li>
  <li>::status-conversion <a href="com.walmartlabs.lacinia.pedestal.html#var-status-conversion-interceptor">status-conversion-interceptor</a></li>
  <li>::missing-query <a href="com.walmartlabs.lacinia.pedestal.html#var-missing-query-interceptor">missing-query-interceptor</a></li>
  <li>::query-parser <a href="com.walmartlabs.lacinia.pedestal.html#var-query-parser-interceptor">query-parser-interceptor</a></li>
  <li>::disallow-subscriptions <a href="com.walmartlabs.lacinia.pedestal.html#var-disallow-subscriptions-interceptor">disallow-subscriptions-interceptor</a></li>
  <li>::inject-app-context <a href="com.walmartlabs.lacinia.pedestal.html#var-inject-app-context-interceptor">inject-app-context-interceptor</a></li>
  <li>::query-executor <a href="com.walmartlabs.lacinia.pedestal.html#var-query-executor-handler">query-executor-handler</a> or <a href="com.walmartlabs.lacinia.pedestal.html#var-async-query-executor-handler">async-query-executor-handler</a></li>
</ul>
<p><code>compiled-schema</code> may be the actual compiled schema, or a no-arguments function that returns the compiled schema.</p>
<p>Options:</p>
<dl>
  <dt>:async (default false)
  </dt>
  <dd>If true, the query will execute asynchronously.</dd>
  <dt>:app-context
  </dt>
  <dd>The base application context provided to Lacinia when executing a query.</dd>
</dl></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L286">view source</a></div></div><div class="public anchor" id="var-graphql-routes"><h3>graphql-routes</h3><div class="usage"><code>(graphql-routes compiled-schema options)</code></div><div class="doc"><div class="markdown"><p>Creates default routes for handling GET and POST requests (at <code>/graphql</code>) and (optionally) the GraphiQL IDE (at <code>/</code>).</p>
<p>Returns a set of route vectors, compatible with <code>io.pedestal.http.route.definition.table/table-routes</code>.</p>
<p>Uses <a href="com.walmartlabs.lacinia.pedestal.html#var-graphql-interceptors">graphql-interceptors</a> to define the base set of interceptors and dependencies. For the POST route, <a href="com.walmartlabs.lacinia.pedestal.html#var-body-data-interceptor">body-data-interceptor</a> is spliced in.</p>
<p><code>compiled-schema</code> may be the actual compiled schema, or a no-arguments function that returns the compiled schema.</p>
<p>Options:</p>
<dl>
  <dt>:graphiql (default false)
  </dt>
  <dd>If true, enables routes for the GraphiQL IDE.</dd>
  <dt>:async (default false)
  </dt>
  <dd>If true, the query will execute asynchronously; the handler will return a clojure.core.async  channel rather than blocking.</dd>
  <dt>:app-context
  </dt>
  <dd>The base application context provided to Lacinia when executing a query.</dd>
</dl></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L347">view source</a></div></div><div class="public anchor" id="var-inject-app-context-interceptor"><h3>inject-app-context-interceptor</h3><h4 class="added">added in 0.2.0</h4><div class="usage"><code>(inject-app-context-interceptor app-context)</code></div><div class="doc"><div class="markdown"><p>Adds a :lacinia-app-context key to the request, used when executing the query.</p>
<p>The provided app-context map is augmented with the request map, as key :request.</p>
<p>It is not uncommon to replace this interceptor with one that constructs the application context dynamically; for example, to extract authentication information from the request and expose that as app-context keys.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L204">view source</a></div></div><div class="public anchor" id="var-json-response-interceptor"><h3>json-response-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>An interceptor that sees if the response body is a map and, if so, converts the map to JSON and sets the response Content-Type header.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L92">view source</a></div></div><div class="public anchor" id="var-missing-query-interceptor"><h3>missing-query-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Rejects the request when there’s no GraphQL query in the request map.</p>
<p>This must come after <a href="com.walmartlabs.lacinia.pedestal.html#var-graphql-data-interceptor">graphql-data-interceptor</a>, which is responsible for adding the query to the request map.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L134">view source</a></div></div><div class="public anchor" id="var-parse-content-type"><h3>parse-content-type</h3><div class="usage"><code>(parse-content-type s)</code></div><div class="doc"><div class="markdown"><p>Parse <code>s</code> as an RFC 2616 media type.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L37">view source</a></div></div><div class="public anchor" id="var-pedestal-service"><h3>pedestal-service</h3><div class="usage"><code>(pedestal-service compiled-schema options)</code></div><div class="doc"><div class="markdown"><p>Creates and returns a Pedestal service map, ready to be started. This uses a server type of :jetty.</p>
<p>Options:</p>
<dl>
  <dt>:graphiql (default: false)
  </dt>
  <dd>If given, then enables resources to support the GraphiQL IDE</dd>
  <dt>:routes (default: via <a href="com.walmartlabs.lacinia.pedestal.html#var-graphql-routes">graphql-routes</a>)
  </dt>
  <dd>Used when explicitly setting up the routes</dd>
  <dt>:subscriptions (default: false)
  </dt>
  <dd>If enabled, then support for WebSocket-based subscriptions is added.</dd>
  <dd>See <a href="com.walmartlabs.lacinia.pedestal.subscriptions.html#var-listener-fn-factory">listener-fn-factory</a> for further options related to subscriptions.</dd>
  <dt>:port (default: 8888)
  </dt>
  <dd>HTTP port to use.</dd>
  <dt>:env (default: :dev)
  </dt>
  <dd>Environment being started.</dd>
</dl></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L381">view source</a></div></div><div class="public anchor" id="var-query-executor-handler"><h3>query-executor-handler</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The handler at the end of interceptor chain, invokes Lacinia to execute the query and return the main response.</p>
<p>The handler adds the Ring request map as the :request key to the provided app-context before executing the query.</p>
<p>This comes after <a href="com.walmartlabs.lacinia.pedestal.html#var-query-parser-interceptor">query-parser-interceptor</a>, <a href="com.walmartlabs.lacinia.pedestal.html#var-inject-app-context-interceptor">inject-app-context-interceptor</a>, and <a href="com.walmartlabs.lacinia.pedestal.html#var-status-conversion-interceptor">status-conversion-interceptor</a> in the interceptor chain.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L242">view source</a></div></div><div class="public anchor" id="var-query-parser-interceptor"><h3>query-parser-interceptor</h3><div class="usage"><code>(query-parser-interceptor compiled-schema)</code></div><div class="doc"><div class="markdown"><p>Given an schema, returns an interceptor that parses the query.</p>
<p><code>compiled-schema</code> may be the actual compiled schema, or a no-arguments function that returns the compiled schema.</p>
<p>Expected to come after <a href="com.walmartlabs.lacinia.pedestal.html#var-missing-query-interceptor">missing-query-interceptor</a> in the interceptor chain.</p>
<p>Adds a new request key, :parsed-lacinia-query, containing the parsed and prepared query.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L151">view source</a></div></div><div class="public anchor" id="var-routes-from-interceptor-map"><h3>routes-from-interceptor-map</h3><h4 class="added">added in 0.3.0</h4><div class="usage"><code>(routes-from-interceptor-map route-path get-interceptor-map)</code></div><div class="doc"><div class="markdown"><p>Returns a set of route vectors from a primary interceptor dependency map. This uses a standard rule for splicing in the POST support.</p>
<p>This function is useful as an alternative to <a href="com.walmartlabs.lacinia.pedestal.html#var-graphql-routes">graphql-routes</a> when the default interceptor dependency map (from <a href="com.walmartlabs.lacinia.pedestal.html#var-graphql-interceptors">graphql-interceptors</a>) is modified.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L328">view source</a></div></div><div class="public anchor" id="var-status-conversion-interceptor"><h3>status-conversion-interceptor</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Checks to see if any error map in the :errors key of the response contains a :status value. If so, the maximum status value of such errors is found and used as the status of the overall response, and the :status key is dissoc’ed from all errors.</p></div></div><div class="src-link"><a href="https://github.com/walmartlabs/pedestal-lacinia/blob/master/src/com/walmartlabs/lacinia/pedestal.clj#L184">view source</a></div></div></div></body></html>